# ================================================
# Clockify RAG Service Configuration
# ================================================
#
# Copy this file to .env and customize for your deployment
# All values are examples - adjust according to your environment

# ====== OLLAMA / LLM CONFIGURATION ======
# Remote Ollama endpoint (default: company VPN host; override to http://127.0.0.1:11434 for local runs)
RAG_OLLAMA_URL=http://10.127.0.192:11434

# Generation model (default: Qwen 2.5 32B)
RAG_CHAT_MODEL=qwen2.5:32b

# Embedding model (default: nomic-embed-text)
RAG_EMBED_MODEL=nomic-embed-text:latest

# Optional: set to "mock" to force the deterministic offline client (useful for CI)
# RAG_LLM_CLIENT=mock

# Legacy aliases (OLLAMA_URL / GEN_MODEL / EMB_MODEL) remain supported but new RAG_* names are preferred.

# ====== EMBEDDING BACKEND ======
# Choose embedding backend: "local" (SentenceTransformer) or "ollama"
EMB_BACKEND=local

# ====== RETRIEVAL PARAMETERS ======
# Default top-K candidates for retrieval (1-100)
DEFAULT_TOP_K=15

# Number of snippets to pack in context (1-50)
DEFAULT_PACK_TOP=8

# Cosine similarity threshold (0.0-1.0)
DEFAULT_THRESHOLD=0.25

# Hybrid retrieval weight: alpha*BM25 + (1-alpha)*dense (0.0-1.0)
ALPHA=0.5

# Enable intent-based retrieval for improved accuracy
USE_INTENT_CLASSIFICATION=1

# ====== CONTEXT AND PERFORMANCE ======
# Context token budget (effective context is min of this and num_ctx*0.6)
CTX_BUDGET=12000

# LLM context window size
DEFAULT_NUM_CTX=32768

# Maximum tokens to generate
DEFAULT_NUM_PREDICT=512

# MMR lambda for diversity vs relevance (0.0-1.0)
MMR_LAMBDA=0.75

# ====== ANNOTATION NEAREST NEIGHBORS (ANN) ======
# ANN backend: "faiss" or "none" (for full-scan)
ANN=faiss

# FAISS parameters
ANN_NLIST=64
ANN_NPROBE=16
FAISS_CANDIDATE_MULTIPLIER=3
ANN_CANDIDATE_MIN=200

# ====== BM25 PARAMETERS (for technical documentation) ======
BM25_K1=1.2
BM25_B=0.65

# ====== TIMEOUT CONFIGURATION ======
# Embedding timeouts (connect/read in seconds)
EMB_CONNECT_TIMEOUT=3.0
EMB_READ_TIMEOUT=60.0

# Chat/LM timeouts (connect/read in seconds)
CHAT_CONNECT_TIMEOUT=3.0
CHAT_READ_TIMEOUT=120.0

# Reranking timeout (in seconds)
RERANK_READ_TIMEOUT=180.0

# ====== EMBEDDING BATCHING ======
# Parallel embedding generation
EMB_MAX_WORKERS=8
EMB_BATCH_SIZE=32

# ====== API GATEKEEPING ======
# API auth: set to "api_key" and provide comma-separated API_ALLOWED_KEYS to enforce shared secret auth
API_AUTH_MODE=none
API_ALLOWED_KEYS=
API_KEY_HEADER=x-api-key

# ====== CACHING AND RATE LIMITING ======
# Query cache size
CACHE_MAXSIZE=100

# Cache TTL in seconds
CACHE_TTL=3600

# Rate limiting: max requests per window
RATE_LIMIT_REQUESTS=10

# Rate limiting window in seconds
RATE_LIMIT_WINDOW=60

# ====== BUILD AND INDEXING ======
# Build lock TTL in seconds
BUILD_LOCK_TTL_SEC=900

# Warm-up on startup
WARMUP=1
# Auto-download required NLTK corpora on startup (set to 0 for fully offline images)
NLTK_AUTO_DOWNLOAD=1

# ====== CHUNKING PARAMETERS ======
# Chunk size and overlap
CHUNK_CHARS=1600
CHUNK_OVERLAP=200

# ====== QUERY LOGGING ======
# Query log file path
RAG_LOG_FILE=rag_queries.jsonl

# Include answer text in logs (set to 0 to redact for privacy)
RAG_LOG_INCLUDE_ANSWER=1

# Answer placeholder when redacted
RAG_LOG_ANSWER_PLACEHOLDER=[REDACTED]

# Include chunk text in logs (set to 0 for security/privacy)
RAG_LOG_INCLUDE_CHUNKS=0

# Enable strict citation validation
RAG_STRICT_CITATIONS=0

# ====== PROXY CONFIGURATION ======
# Enable proxy support (set to 1 to allow proxy usage)
ALLOW_PROXIES=0

# HTTP proxy URL (if needed)
HTTP_PROXY=
HTTPS_PROXY=

# ====== RETRIES ======
# Default number of retries for transient errors
DEFAULT_RETRIES=2

# ====== PRECOMPUTED FAQ CACHE ======
# Enable precomputed FAQ cache
FAQ_CACHE_ENABLED=0
FAQ_CACHE_PATH=faq_cache.json

# Maximum query length (for DoS protection)
MAX_QUERY_LENGTH=1000000

# Query expansion file path
CLOCKIFY_QUERY_EXPANSIONS=config/query_expansions.json

# Maximum query expansion file size (in bytes)
MAX_QUERY_EXPANSION_FILE_SIZE=10485760
